<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<title>Mini Cookie Clicker - Consentement</title>
	<style>
		body.color {
  			margin: 0;
			padding: 0;
  			font-family: Arial, sans-serif;
  			transition: background-color 0.3s ease;
		}
		body.gradient {
			font-family: Arial, sans-serif;
			background-size: cover;
			margin: 0;
			padding: 0;
			height: 100vh;
  			background: linear-gradient(to top right,rgba(0, 0, 255, 1) 0%, rgba(255, 0, 0, 1) 100%);
		}
		body.image {
			font-family: Arial, sans-serif;
			background-size: cover;
			margin: 0;
			padding: 0;
			height: 100vh;
			background-image:url("https://raw.githubusercontent.com/pizzasdu83/ressources/main/suyu__Pattern-Background.png"); no-repeat;
		}
		body.preview {
			margin: 0;
			padding: 0;
			height: 100vh;
			background-size: cover;
			background-position: center;
		}
		/* Bouton flottant */
		#cookie-manager-btn {
			position: fixed;
			bottom: 20px;
			right: 20px;
			border: none;
			border-radius: 50%;
			width: 60px;
			height: 60px;
			cursor: pointer;
			font-size: 30px;
			box-shadow: 0 4px 6px rgba(0,0,0,0.3);
		}
		/* Pop-up */
		#cookie-popup {
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: #fff;
			padding: 20px;
			width: 340px;
			border: 2px solid #333;
			border-radius: 10px;
			box-shadow: 0 8px 15px rgba(0,0,0,0.5);
			text-align: center;
			z-index: 1000;
			animation: depixelate 0.3s ease-out forwards;
		}
		#big-cookie {
			width: 100px;
			height: 100px;
			background: url("https://static.wikia.nocookie.net/cookieclicker/images/5/5a/PerfectCookie.png");
			background-size: cover;
			border-radius: 50%;
			margin: 15px auto;
			cursor: pointer;
			transition: transform 0.1s;
		}
		#big-cookie:active {
			transform: scale(0.9);
		}
		#preview {
			margin: 0;
			padding: 0;
			height: 100vh;
			background-size: cover;
			background-position: center;
		}
		button {
			margin: 5px;
			padding: 8px 15px;
			font-size: 14px;
			cursor: pointer;
			border: none;
			border-radius: 5px;
		}

		@keyframes pixelate {
			from {
				filter: blur(0);
				transform: scale(1);
				transform: translate(-50%, -50%);
				opacity: 1;
			}
			to {
				filter: blur(8px);
				transform: scale(0.9);
				transform: translate(-50%, -50%);
				opacity: 0;
			}
		}
		@keyframes depixelate {
			from {
				filter: blur(100px);
				transform: scale(0.9);
				transform: translate(-50%, -50%);
				opacity: 0;
			}
			to {
				filter: blur(0);
				transform: scale(1);
				transform: translate(-50%, -50%);
				opacity: 1;
			}
		}
		.store-btn { background: #ddd; }
		.accept-btn { background: #4CAF50; color: white; }
		.refuse-btn { background: #f44336; color: white; }

	</style>
</head>
<body>
	<!-- Bouton flottant -->
	<input type="image" src="gcookie.png" id="cookie-manager-btn" onclick="openPopup()" width="60" height="60">

	<!-- Pop-up du mini-jeu -->
	<div id="cookie-popup">
		<h2>Gestion des cookies</h2>
		<p>Cookies collectÃ©s : <span id="cookie-count">0</span></p>
		<div id="big-cookie" onclick="clickCookie()"></div>
		<p>ðŸŽ¯ Objectif : <span id="goal">1000</span> cookies</p>

		<div id="store">
			<h3>Magasin</h3>
			<button class="store-btn" onclick="buyUpgrade('click')">+1 par clic (coÃ»t 10)</button>
			<button class="store-btn" onclick="buyUpgrade('auto')">Auto-click (coÃ»t 30)</button>
		</div>

		<!-- SÃ©lecteur de couleur -->
		<div id="color-menu" style="margin-top:15px; display:none;">
			<h3>ðŸŽ¨ Choisis ton fond</h3>
				<label>
					<input type="radio" name="bgmode" value="free" checked onchange="setBackgroundMode(this.value)">Couleure libre
				</label><br>
					<input type="color" id="colorPicker" onchange="setColor(this.value)">
				<label>
					<input type="radio" name="bgmode" value="preset-gradient" onchange="setBackgroundMode(this.value)">Couleure Signature
				</label><br>
				<label>
					<input type="radio" name="bgmode" value="preset-image" onchange="setBackgroundMode(this.value)">Suyu
				</label><br>
				<label>
					<input type="radio" name="bgmode" value="persimage" checked onchange="setBackgroundMode(this.value)">Image libre
				</label>
				<label>
				<input type="file" id="avatar" name="avatar" accept="image/png, image/jpeg" />
				</label>
				
		</div>

		<div id="choices" style="margin-top:15px;">
			<button class="accept-btn" onclick="acceptCookies()" enabled>Accepter</button>
			<button class="refuse-btn" onclick="refuseCookies()" disabled>Refuser</button>
		</div>
	</div>

	<script>
		// --- Fonctions cookies navigateur ---
		function setCookie(name, value, days) {
			const d = new Date();
			d.setTime(d.getTime() + (days*24*60*60*1000));
			document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/;SameSite=Lax;Secure";
		}


		function getCookie(name) {
			const cname = name + "=";
			const ca = document.cookie.split(';');
			for (let c of ca) {
				c = c.trim();
				if (c.indexOf(cname) === 0) {
					return c.substring(cname.length);
				}
			}
			return "";
		}

		function eraseCookie(name) {
			document.cookie = name+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
		}

		// --- Mini Cookie Clicker ---
		let cookies = parseInt(getCookie("cookies") || "0");
		let perClick = parseInt(getCookie("perClick") || "1");
		let autoClick = parseInt(getCookie("autoClick") || "0");
		let bgColor = getCookie("bgcolor") || "";
		let opened = 0;
		const goal = 1000;

		const countEl = document.getElementById("cookie-count");
		const acceptBtn = document.querySelector(".accept-btn");
		const refuseBtn = document.querySelector(".refuse-btn");
		const colorMenu = document.getElementById("color-menu");
		const colorPicker = document.getElementById("colorPicker");

		function updateDisplay() {
			countEl.textContent = cookies;
			// DÃ©bloquer les choix aprÃ¨s l'objectif
			if (cookies >= goal) {
				refuseBtn.disabled = false;
			}
			// DÃ©bloquer le menu couleur aprÃ¨s 5 cookies
			if (cookies >= 5) {
				colorMenu.style.display = "block";
			}
		}

		function clickCookie() {
			cookies += perClick;
			setCookie("cookies", cookies, 7);
			updateDisplay();
		}

		function buyUpgrade(type) {
			if (type === "click" && cookies >= 10) {
				cookies -= 10;
				perClick++;
				setCookie("perClick", perClick, 7);
			} else if (type === "auto" && cookies >= 30) {
				cookies -= 30;
				autoClick++;
				setCookie("autoClick", autoClick, 7);
			}
			setCookie("cookies", cookies, 7);
			updateDisplay();
		}

		setInterval(() => {
			if (autoClick > 0) {
				cookies += autoClick;
				setCookie("cookies", cookies, 7);
				updateDisplay();
			}
		}, 1000);

		// --- Couleur du fond ---
		function setColor(color) {
			bgColor = color;
			setCookie("bgcolor", bgColor, 7);
			applyColor();
		}

		function applyColor() {
			const color = getCookie("bgcolor");
			if (color) {
				document.body.style.backgroundColor = color;
				if (colorPicker) colorPicker.value = color; // maj du sÃ©lecteur
			}
		}

		// --- Consentement ---
		function acceptCookies() {
			alert("Tu as acceptÃ© les cookies ðŸª");
			closePopup();
		}

		function refuseCookies() {
			alert("Tu as refusÃ© les cookies âŒ");
			// reset progression
			setCookie("cookies", 0, 7);
			setCookie("perClick", 1, 7);
			setCookie("autoClick", 0, 7);
			eraseCookie("bgcolor");
			document.body.style.backgroundColor = "";
			closePopup();
		}

		// --- Popup ---
		function openPopup() {
			if (opened == 0){
				document.getElementById("cookie-popup").style.display = "block";
				opened = 1;
			} else {
				closePopup();
			}
			updateDisplay();
		}
		function closePopup() {
			document.getElementById("cookie-popup").style.display = "none";
			opened = 0
		}

		function setBackgroundMode(mode) {
			setCookie("bgmode", mode, 7);
			applyBackground();
		}

		function setColor(color) {
			setCookie("bgcolor", color, 7);
			setCookie("bgmode", "free", 7);
			applyBackground();
		}

// Applique le fond selon le mode
		function applyBackground() {
			let mode = getCookie("bgmode") || "free";

	// reset classes
			document.body.classList.remove("color", "gradient", "image");
			document.body.style.background = "";
			document.body.style.backgroundColor = "";
			document.body.style.backgroundImage = "";

			if (mode === "free") {
				let color = getCookie("bgcolor") || "#ffffff";
				document.body.classList.add("color");
				document.body.style.backgroundColor = color;
				if (colorPicker) colorPicker.value = color; // MAJ du picker
			} else if (mode === "preset-gradient") {
				document.body.classList.add("gradient");
			} else if (mode === "preset-image") {
				document.body.classList.add("image");
			} else if (mode === "persimage") {
				document.getElementById("avatar").addEventListener("change", function () {
					const file = this.files[0];
					if (!file) return;

					const url = URL.createObjectURL(file);
					document.body.classList.add("preview");

					const preview = document.getElementById("preview");
					body.preview.style.backgroundImage = `url(${url})`;
				});
			}

	// cocher le bon radio
			let radios = document.querySelectorAll('input[name="bgmode"]');
			radios.forEach(r => {
				r.checked = (r.value === mode);
			});
		}
		function setBackgroundMode(mode) {
			setCookie("bgmode", mode, 7);
			applyBackground();
		}
		// Charger progression
		updateDisplay();
		applyColor();
		applyBackground();
	</script>
</body>
</html>
